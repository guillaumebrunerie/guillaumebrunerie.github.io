import{r as X,j as d,a as $}from"./index-0822f197.js";const w={R:"red",G:"green",B:"blue",Y:"yellow",O:"orange",M:"magenta",P:"purple",T:"#00B0B0"},m=n=>{const t=n.split("_"),o=(t.length==2?t[0]:t[1]).split(""),e=(t.length==2?t[1]:t[2]).split("");return{shape:o,colors:e}},p=100,x=[0,1,2,3],E=(n,t,o)=>{const e=[];for(const s of n){const{shape:r,colors:a}=m(s);for(const l of n){const{shape:c,colors:h}=m(l);for(const i of x)for(const f of x)h[f]===a[i]&&H(r[i],c[f])&&v(r[(i+1)%4],c[(f+3)%4])&&v(r[(i+3)%4],c[(f+1)%4])&&e.push({from:s,to:l,rotation:180+i*90-f*90,dx:Math.cos((i-1)*Math.PI/2)*p,dy:Math.sin((i-1)*Math.PI/2)*p})}}for(const s of n){const{shape:r,colors:a}=m(s);for(const l of x)for(let c=0;c<o;c++){const h=t[l][c*2+1];for(const i of x){if(a[i]!==h)continue;switch(r[i]){case"l":if(c!==o-1)continue;break;case"r":if(c!==0)continue;break;case"-":if(c===0||c===o-1)continue;break;default:continue}const[f,u]=$([(c-o/2)*100+50,-o/2*100+50],l*90);e.push({from:"background",to:s,rotation:i*90-l*90,dx:f+(o+1)*50,dy:u+(o+1)*50})}}}return e},R=.1,C=-.05,j=.5,S=-.05,g=.4,P=.1,F=1,T=g+(g-j)*F,L=P+(P-S)*F,b=["C",[R,C],[j,S],[g,P],"C",[T,L],[1-T,L],[1-g,P],"C",[1-j,S],[1-R,C],[1,0]],Y=["L",[1,0]],_=["L",[.6,0],"C",[.7,0],[.8,0],[.9,.1],"M",[1,0]],Q=["M",[.1,.1],"C",[.2,0],[.3,0],[.4,0],"L",[1,0]],W=()=>`M ${-p/2}, ${-p/2}`,O=()=>"z",M=(n,t,o,e,s,r)=>{const a=o-n,l=e-t,c=Math.sqrt(a*a+l*l),h=Math.atan2(l,a),i=u=>Number(u.toFixed(5)),f=(u,I,y)=>`${i(n+c*(u*Math.cos(h)-y*I*Math.sin(h)))},${i(t+c*(u*Math.sin(h)+y*I*Math.cos(h)))}`;return r.map(u=>typeof u=="string"?u:f(u[0],u[1],s)).join(" ")},k=(n,t)=>{const o=Math.cos(t*Math.PI/2-Math.PI/2-Math.PI/4)*Math.SQRT2*p/2,e=Math.sin(t*Math.PI/2-Math.PI/2-Math.PI/4)*Math.SQRT2*p/2,s=Math.cos(t*Math.PI/2-Math.PI/4)*Math.SQRT2*p/2,r=Math.sin(t*Math.PI/2-Math.PI/4)*Math.SQRT2*p/2;switch(n[t]){case"-":return M(o,e,s,r,1,Y);case"l":return M(o,e,s,r,1,_);case"r":return M(o,e,s,r,1,Q);case"^":return M(o,e,s,r,-1,b);case"v":return M(o,e,s,r,1,b)}},G=X.memo(({pieceId:n})=>{if(n==="background")return null;const{shape:t,colors:o}=m(n);let e=`${W()} ${k(t,0)} ${k(t,1)} ${k(t,2)} ${k(t,3)} ${O()}`;return e=e.replace(/M [-\d]+,[-\d]+ M [-\d]+,[-\d]+ /g,""),d.jsxs("g",{children:[d.jsx("clipPath",{id:`piece_${n}`,children:d.jsx("path",{d:e})}),d.jsx("g",{clipPath:`url(#piece_${n})`,children:o.map((s,r)=>d.jsx("rect",{x:"0",y:"0",width:p*2,height:p*2,transform:`rotate(${-135+90*r})`,fill:w[s]},r))}),d.jsx("path",{d:e,stroke:"black",strokeWidth:"1px",fill:"none"})]})}),q=(n,t)=>()=>{const o=t*100/2,e=`M ${-o-40} ${-o-40} L ${o+40} ${-o-40} L ${o+40} ${o+40} L ${-o-40} ${o+40} z`;let s=`M ${-o}, ${-o}`;for(let a=0;a<4;a++)for(let l=0;l<t;l++){const c=l==0?Q:l==t-1?_:Y,[h,i]=$([-o+100*l,-o],-a*90),[f,u]=$([-o+100*(l+1),-o],-a*90);s+=" ",s+=M(h,i,f,u,1,c)}s+=" z",s=s.replace(/M [-\d]+,[-\d]+ M [-\d]+,[-\d]+ /g,"");let r="";for(let a=0;a<t;a++)for(let l=0;l<t;l++){const c=-o+a*100,h=-o+l*100,i=(a+l)%2==0?-1:1;a>0&&(r+=`M ${c}, ${h} ${M(c,h,c,h+100,i,b)}`),l>0&&(r+=`M ${c}, ${h} ${M(c,h,c+100,h,i,b)}`)}return d.jsxs("g",{transform:`translate(${o+50}, ${o+50})`,children:[d.jsx("clipPath",{id:"background",children:d.jsx("path",{d:e})}),d.jsx("g",{clipPath:"url(#background)",children:[0,1,2,3].map(a=>n[a].split("").map((l,c)=>d.jsx("rect",{width:50*Math.SQRT2,height:50*Math.SQRT2,transform:`rotate(${a*90}) translate(${c*50-o}, ${c%2==0?-o:-o+50}) rotate(225)`,fill:w[l]},c)))}),d.jsx("path",{d:s,stroke:"none",fill:"grey"}),d.jsx("path",{d:r,stroke:"#666",fill:"none",strokeWidth:"1px"}),d.jsx("path",{d:s,stroke:"black",strokeWidth:"1px",fill:"none"}),d.jsx("path",{d:e,stroke:"black",strokeWidth:"1px",fill:"none"})]})},H=(n,t)=>n=="v"&&t=="^"||n=="^"&&t=="v",v=(n,t)=>["-","l","r"].includes(n)&&["-","l","r"].includes(t)||n=="v"&&t=="^"||n=="^"&&t=="v",N=(n,t)=>(8+t-Math.round(n/90)%4)%4,Z=(n,t)=>o=>{for(const e of o)for(const s of o)if(e.pieceId!==s.pieceId){if(e.pieceId!=="background"&&s.pieceId!=="background"){const r=s.x-e.x,a=s.y-e.y;if(Math.abs(r)<1&&Math.abs(a)<1)return!1}for(const r of B(e,n,t))for(const a of B(s,n,t))if(J(r,a))return!1}return!0},A=n=>(n+2)%4,B=(n,t,o)=>{if(n.pieceId==="background"){const e=[];for(const s of x)for(let r=0;r<t;r++){const a=o[s][r*2+1],l=r==0?"R":r==t-1?"L":"_",[c,h]=$([(r-t/2)*100+50,-t/2*100],-s*90),[i,f]=[(t+1)*50+c,(t+1)*50+h];e.push({shape:l,color:a,side:A(s),x:i,y:f})}return e}else{const{shape:e,colors:s}=m(n.pieceId);return x.map(r=>{const a=N(n.rotation,r),[l,c]=$([0,-50],-r*90),[h,i]=[n.x+l,n.y+c];return{shape:e[a],color:s[a],side:r,x:h,y:i}})}},D=["v^","^v","-_","_-","lL","Ll","rR","Rr"],J=(n,t)=>Math.abs(t.x-n.x)>1||Math.abs(t.y-n.y)>1?!1:n.side!==(t.side+2)%4||n.color!==t.color?!0:!D.includes(n.shape+t.shape),U=({size:n,pieces:t,background:o})=>{const e=t.map((s,r)=>`${r}_${s}`);return{width:50+n*100+50,height:50+n*100+50,rotations:4,pieces:e,connections:E(e,o,n),globalRestrictions:Z(n,o),Background:q(o,n),Piece:G}};export{U as default};
